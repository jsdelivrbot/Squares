<!DOCTYPE html>

<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script>
            "use strict";
            
            let HOST = location.origin.replace(/^http/, 'ws');
            let ws = new WebSocket(HOST);
            //let el = document.getElementById('server-time');
            document.addEventListener("click", onClick);

            function onClick(data) {
                let click = [
                    "click", data.clientX, data.clientY
                ];
                ws.send(JSON.stringify(click));
            };

            ws.onopen = function () {
                console.log(`connected`);
            };
            
            //ws.send(JSON.stringify());
            
            ws.onmessage = function (event) {
                messageRouter(JSON.parse(event.data));
            };
            
            let messageRouter = (message) => {
                switch (message[0]) {
                    case 'newSquare':
                        newSquare(message[1], message[2], message[3], message[4], message[5]);
                        break;
                    case 'hitSquare':
                        hitSquare(message[1]);
                        break;
                    case 'onlineClients':
                        onlineClients(message[1]);
                        break;
                    case 'score':
                        score(message[1]);
                        break;
                    default:
                        console.log(`Unknown message: ${message}`);
                }
            };
            
            let newSquare = (id, x, y, width, height) => {
                let square = document.createElement("div");
                square.setAttribute("id", id);
                square.style.position = "fixed";
                square.style.left = x + "px";
                square.style.top = y + "px";
                square.style.width = width + "px";
                square.style.height = height + "px";
                square.style.border = "2px solid #000000"; 
                square.style.background = "#EFEFEF"; ; 
                
                document.body.appendChild(square);
            };
            
            let hitSquare = (id) => {
                document.getElementById(id).remove();
            };
            
            let onlineClients = (onlineClients) => {
                document.getElementById("onlineClients").innerHTML = onlineClients;
            };
            
            let score = (score) => {
                document.getElementById("score").innerHTML = score;
            };
        </script>
    </head>
    <body>
        <div>Online clients: <span id="onlineClients">0</span> Score: <span id="score">0</span></div>
    </body>
</html>